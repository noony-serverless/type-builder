<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraFastBuilder - Functional Programming Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            animation: fadeIn 1s ease;
        }

        .subtitle {
            text-align: center;
            font-size: 1.3em;
            opacity: 0.95;
            margin-bottom: 30px;
            animation: fadeIn 1.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-canvas-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            color: #333;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }

        #performanceCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            color: #333;
        }

        .controls h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-item label {
            font-weight: 600;
            color: #555;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        select, input[type="number"] {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: #333;
        }

        .info-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-card ul {
            list-style: none;
            padding: 0;
        }

        .info-card li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-card li:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 600;
            color: #666;
        }

        .stat-value {
            font-weight: 700;
            color: #333;
        }

        .best-value {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
        }

        .comparison-table {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: #333;
            margin-bottom: 30px;
        }

        .comparison-table h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.6em;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .progress-container {
            display: none;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #555;
        }

        .running {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .star {
            color: #ffd700;
            font-size: 1.2em;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }

        .status-dot.ready {
            background: #4CAF50;
        }

        .status-dot.error {
            background: #f44336;
        }

        .code-section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: #333;
            margin-bottom: 30px;
        }

        .code-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.6em;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }

        .code-section h3:hover {
            color: #5a6fd8;
        }

        .code-toggle {
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .code-toggle.expanded {
            transform: rotate(90deg);
        }

        .code-content {
            display: none;
            margin-top: 20px;
        }

        .code-content.expanded {
            display: block;
        }

        .code-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .code-tab {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #666;
        }

        .code-tab:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .code-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            border: 1px solid #4a5568;
        }

        .code-block .comment {
            color: #68d391;
        }

        .code-block .keyword {
            color: #f687b3;
        }

        .code-block .string {
            color: #fbb6ce;
        }

        .code-block .function {
            color: #90cdf4;
        }

        .code-block .variable {
            color: #faf089;
        }

        .dashboard-links {
            text-align: center;
            margin: 20px 0;
        }

        .dashboard-link {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .dashboard-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 UltraFastBuilder</h1>
        <p class="subtitle">Functional Programming Performance Visualizer</p>
        <div class="dashboard-links">
            <a href="builder_visual_dashboard.html" class="dashboard-link">
                ⚡ Builder Performance Dashboard
            </a>
        </div>

        <div class="main-canvas-container">
            <div class="status-indicator">
                <div class="status-dot" id="libraryStatusDot"></div>
                <span id="libraryStatus">Loading UltraFastBuilder library...</span>
            </div>
            
            <div class="canvas-container">
                <canvas id="performanceCanvas"></canvas>
            </div>
        </div>

        <div class="controls">
            <h3>🎛️ Test Controls</h3>
            <div class="control-group">
                <div class="control-item">
                    <label for="iterations">Iterations:</label>
                    <input type="number" id="iterations" value="10000" min="100" max="1000000" step="1000">
                </div>
                <div class="control-item">
                    <label for="testType">Test Type:</label>
                    <select id="testType">
                        <option value="all">All Functional Tests</option>
                        <option value="pipe">Pipe Operations</option>
                        <option value="compose">Compose Functions</option>
                        <option value="curry">Currying</option>
                        <option value="immutable">Immutable Builders</option>
                        <option value="higher-order">Higher-Order Functions</option>
                    </select>
                </div>
                <div class="control-item">
                    <label for="complexity">Complexity:</label>
                    <select id="complexity" onchange="updateCodeExamples()">
                        <option value="simple">Simple</option>
                        <option value="medium" selected>Medium</option>
                        <option value="complex">Complex</option>
                    </select>
                </div>
            </div>
            <div class="button-group">
                <button onclick="runFunctionalTest()" id="runBtn">▶️ Run Functional Test</button>
                <button onclick="clearResults()">🗑️ Clear Results</button>
                <button onclick="exportData()">💾 Export Data</button>
            </div>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-text" id="progressText">Preparing test...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="comparison-table">
            <h3>📊 Performance Comparison</h3>
            <table>
                <thead>
                    <tr>
                        <th>Test Type</th>
                        <th>Throughput</th>
                        <th>Speed</th>
                        <th>Memory Usage</th>
                        <th>Winner</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pipe Operations</td>
                        <td id="pipe-ops">-</td>
                        <td id="pipe-speed">-</td>
                        <td id="pipe-memory">-</td>
                        <td id="winner-pipe">-</td>
                    </tr>
                    <tr>
                        <td>Compose Functions</td>
                        <td id="compose-ops">-</td>
                        <td id="compose-speed">-</td>
                        <td id="compose-memory">-</td>
                        <td id="winner-compose">-</td>
                    </tr>
                    <tr>
                        <td>Currying</td>
                        <td id="curry-ops">-</td>
                        <td id="curry-speed">-</td>
                        <td id="curry-memory">-</td>
                        <td id="winner-curry">-</td>
                    </tr>
                    <tr>
                        <td>Immutable Builders</td>
                        <td id="immutable-ops">-</td>
                        <td id="immutable-speed">-</td>
                        <td id="immutable-memory">-</td>
                        <td id="winner-immutable">-</td>
                    </tr>
                    <tr>
                        <td>Higher-Order Functions</td>
                        <td id="higher-order-ops">-</td>
                        <td id="higher-order-speed">-</td>
                        <td id="higher-order-memory">-</td>
                        <td id="winner-higher-order">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="code-section">
            <h3 onclick="toggleCodeSection()">
                <span class="code-toggle" id="codeToggle">▶</span>
                📝 Test Code Examples
            </h3>
            <div class="code-content" id="codeContent">
                <div class="code-tabs">
                    <div class="code-tab active" onclick="showCodeTab('pipe')">Pipe Operations</div>
                    <div class="code-tab" onclick="showCodeTab('compose')">Compose Functions</div>
                    <div class="code-tab" onclick="showCodeTab('curry')">Currying</div>
                    <div class="code-tab" onclick="showCodeTab('immutable')">Immutable Builders</div>
                    <div class="code-tab" onclick="showCodeTab('higher-order')">Higher-Order Functions</div>
                </div>
                
                <div id="pipe-code" class="code-block">
<span class="comment">// Pipe Operations - Left-to-right function composition</span>
<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">`User ${i}`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">`user${i}@example.com`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'pipe'</span>, <span class="string">'test'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">source</span>: <span class="string">'pipe'</span>, <span class="variable">iteration</span>: <span class="variable">i</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());

<span class="keyword">const</span> <span class="variable">finalUser</span> = <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">user</span>);
                </div>
                
                <div id="compose-code" class="code-block" style="display: none;">
<span class="comment">// Compose Functions - Reusable function combinations</span>
<span class="keyword">const</span> <span class="variable">createBasicUser</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">1</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">'Test User'</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">'test@example.com'</span>)
);

<span class="keyword">const</span> <span class="variable">createActiveUser</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="keyword">true</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>())
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">createBasicUser</span>,
    <span class="variable">createActiveUser</span>,
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'compose'</span>, <span class="string">'test'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">iteration</span>: <span class="variable">i</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());
                </div>
                
                <div id="curry-code" class="code-block" style="display: none;">
<span class="comment">// Currying - Partial function application</span>
<span class="keyword">const</span> <span class="variable">curriedWithId</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">curry2</span>((<span class="variable">id</span>, <span class="variable">state</span>) => 
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">id</span>)(<span class="variable">state</span>)
);

<span class="keyword">const</span> <span class="variable">curriedWithName</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">curry2</span>((<span class="variable">name</span>, <span class="variable">state</span>) => 
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="variable">name</span>)(<span class="variable">state</span>)
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">curriedWithId</span>(<span class="variable">i</span>),
    <span class="variable">curriedWithName</span>(<span class="string">`User ${i}`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">`user${i}@example.com`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'curry'</span>, <span class="string">'test'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">curried</span>: <span class="keyword">true</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());
                </div>
                
                <div id="immutable-code" class="code-block" style="display: none;">
<span class="comment">// Immutable Builders - Pure functional state management</span>
<span class="keyword">const</span> <span class="variable">userBuilder</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">createImmutableBuilder</span>([
    <span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'email'</span>, <span class="string">'age'</span>, 
    <span class="string">'isActive'</span>, <span class="string">'createdAt'</span>, <span class="string">'tags'</span>, <span class="string">'metadata'</span>
]);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">`User ${i}`</span>),
    <span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">`user${i}@example.com`</span>),
    <span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'immutable'</span>, <span class="string">'test'</span>]),
    <span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">immutable</span>: <span class="keyword">true</span> })
)(<span class="variable">userBuilder</span>.<span class="function">empty</span>()));
                </div>
                
                <div id="higher-order-code" class="code-block" style="display: none;">
<span class="comment">// Higher-Order Functions - Array methods and transformations</span>
<span class="comment">// Filter active users</span>
<span class="keyword">const</span> <span class="variable">activeUsers</span> = <span class="variable">testUsers</span>.<span class="function">filter</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">isActive</span>);

<span class="comment">// Map to user names</span>
<span class="keyword">const</span> <span class="variable">userNames</span> = <span class="variable">testUsers</span>.<span class="function">map</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">name</span>);

<span class="comment">// Reduce to total age</span>
<span class="keyword">const</span> <span class="variable">totalAge</span> = <span class="variable">testUsers</span>.<span class="function">reduce</span>((<span class="variable">sum</span>, <span class="variable">user</span>) => <span class="variable">sum</span> + <span class="variable">user</span>.<span class="variable">age</span>, <span class="variable">0</span>);

<span class="comment">// Check if any users are active</span>
<span class="keyword">const</span> <span class="variable">hasActiveUsers</span> = <span class="variable">testUsers</span>.<span class="function">some</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">isActive</span>);

<span class="comment">// Transform users with builder</span>
<span class="keyword">const</span> <span class="variable">transformedUsers</span> = <span class="variable">testUsers</span>.<span class="function">map</span>(<span class="variable">user</span> => {
    <span class="keyword">const</span> <span class="variable">state</span> = <span class="variable">userBuilder</span>.<span class="function">empty</span>();
    <span class="keyword">return</span> <span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
        <span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">user</span>.<span class="variable">id</span>),
        <span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="variable">user</span>.<span class="variable">name</span>.<span class="function">toUpperCase</span>()),
        <span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="variable">user</span>.<span class="variable">email</span>),
        <span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">user</span>.<span class="variable">age</span> + <span class="variable">1</span>),
        <span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(!<span class="variable">user</span>.<span class="variable">isActive</span>),
        <span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="variable">user</span>.<span class="variable">createdAt</span>),
        <span class="variable">userBuilder</span>.<span class="function">withTags</span>([...<span class="variable">user</span>.<span class="variable">tags</span>, <span class="string">'transformed'</span>]),
        <span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ ...<span class="variable">user</span>.<span class="variable">metadata</span>, <span class="variable">transformed</span>: <span class="keyword">true</span> })
    )(<span class="variable">state</span>));
});
                </div>
            </div>
        </div>

        <div class="info-cards">
            <div class="info-card">
                <h3>📈 Test Statistics</h3>
                <ul>
                    <li><span class="stat-label">Total Operations:</span><span class="stat-value" id="totalOps">0</span></li>
                    <li><span class="stat-label">Fastest Test:</span><span class="stat-value" id="fastest">-</span></li>
                    <li><span class="stat-label">Average Throughput:</span><span class="stat-value" id="avgThroughput">-</span></li>
                    <li><span class="stat-label">Memory Efficiency:</span><span class="stat-value" id="memoryEfficiency">-</span></li>
                </ul>
            </div>
            <div class="info-card">
                <h3>🔧 Functional Features</h3>
                <ul>
                    <li><span class="stat-label">Pipe Operations:</span><span class="stat-value">Left-to-right composition</span></li>
                    <li><span class="stat-label">Compose Functions:</span><span class="stat-value">Reusable combinations</span></li>
                    <li><span class="stat-label">Currying:</span><span class="stat-value">Partial application</span></li>
                    <li><span class="stat-label">Immutable Builders:</span><span class="stat-value">Pure functional state</span></li>
                </ul>
            </div>
            <div class="info-card">
                <h3>⚡ Performance Tips</h3>
                <ul>
                    <li><span class="stat-label">Pipe:</span><span class="stat-value">Best for simple chains</span></li>
                    <li><span class="stat-label">Compose:</span><span class="stat-value">Best for reusability</span></li>
                    <li><span class="stat-label">Curry:</span><span class="stat-value">Best for partial application</span></li>
                    <li><span class="stat-label">Immutable:</span><span class="stat-value">Best for data integrity</span></li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        // Global variables
        let canvas, ctx;
        let benchmarkResults = {
            pipe: [],
            compose: [],
            curry: [],
            immutable: [],
            'higher-order': []
        };
        let totalOperations = 0;
        let benchmarkStartTime = 0;
        let metricsInterval = null;
        let currentMemory = 0;

        // Initialize canvas
        function initCanvas() {
            canvas = document.getElementById('performanceCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            drawInitialChart();
        }

        function drawInitialChart() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            
            ctx.clearRect(0, 0, width, height);
            
            // Background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, width, height);
            
            // Grid
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = (width / 10) * i;
                const y = (height / 10) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Title
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 24px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('Functional Programming Performance', width / 2, 40);
            
            // Subtitle
            ctx.fillStyle = '#666';
            ctx.font = '16px Segoe UI';
            ctx.fillText('Run tests to see performance visualization', width / 2, 70);
        }

        function drawChart() {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            
            ctx.clearRect(0, 0, width, height);
            
            // Background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, width, height);
            
            // Get all results
            const allResults = [
                ...benchmarkResults.pipe,
                ...benchmarkResults.compose,
                ...benchmarkResults.curry,
                ...benchmarkResults.immutable,
                ...benchmarkResults['higher-order']
            ];
            
            if (allResults.length === 0) {
                drawInitialChart();
                return;
            }
            
            const maxValue = Math.max(...allResults);
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'];
            const labels = ['Pipe', 'Compose', 'Curry', 'Immutable', 'Higher-Order'];
            
            // Draw bars for each test type
            const barWidth = width / 5;
            const maxHeight = height - 100;
            
            let colorIndex = 0;
            for (const [testType, results] of Object.entries(benchmarkResults)) {
                if (results.length > 0) {
                    const latestResult = results[results.length - 1];
                    const barHeight = (latestResult / maxValue) * maxHeight;
                    const x = colorIndex * barWidth + 20;
                    const y = height - barHeight - 50;
                    
                    // Bar
                    ctx.fillStyle = colors[colorIndex];
                    ctx.fillRect(x, y, barWidth - 40, barHeight);
                    
                    // Label
                    ctx.fillStyle = '#333';
                    ctx.font = 'bold 14px Segoe UI';
                    ctx.textAlign = 'center';
                    ctx.fillText(labels[colorIndex], x + (barWidth - 40) / 2, height - 20);
                    
                    // Value
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Segoe UI';
                    ctx.fillText((latestResult / 1000).toFixed(1) + 'k ops/s', x + (barWidth - 40) / 2, y - 10);
                }
                colorIndex++;
            }
        }

        // Load UltraFastBuilder library
        async function loadLibrary() {
            try {
                console.log('Loading UltraFastBuilder functional library...');
                
                // Import the functional library
                let functionalModule;
                let builder, builderAsync;
                
                try {
                    functionalModule = await import('./builder-dist/functional.mjs');
                    const builderModule = await import('./builder-dist/index.mjs');
                    builder = builderModule.builder;
                    builderAsync = builderModule.builderAsync;
                } catch (e) {
                    console.error('Failed to load functional library:', e);
                    // Create a minimal fallback for testing
                    functionalModule = {
                        createImmutableBuilder: (keys) => {
                            const builder = {
                                empty: () => ({}),
                                build: (state) => ({ ...state }),
                                ...keys.reduce((acc, key) => {
                                    const methodName = `with${key.charAt(0).toUpperCase()}${key.slice(1)}`;
                                    acc[methodName] = (value) => (state) => ({ ...state, [key]: value });
                                    return acc;
                                }, {})
                            };
                            return builder;
                        },
                        pipe: (...fns) => (initial) => fns.reduce((acc, fn) => fn(acc), initial),
                        compose: (...fns) => (initial) => fns.reduceRight((acc, fn) => fn(acc), initial),
                        curry2: (fn) => (a) => (b) => fn(a, b),
                        partialApply: (fn, ...args) => (...moreArgs) => fn(...args, ...moreArgs)
                    };
                    builder = () => ({});
                    builderAsync = () => ({});
                    console.warn('Using fallback functional library for testing');
                }
                
                // Skip Zod for functional tests - we don't need validation
                console.log('Skipping Zod import for functional tests (not needed)');
                const z = null;
                
                // Make available globally
                window.builder = builder;
                window.builderAsync = builderAsync;
                window.z = z;
                window.functional = functionalModule;
                
                console.log('Library loaded successfully:');
                console.log('- builder:', typeof builder);
                console.log('- builderAsync:', typeof builderAsync);
                console.log('- functional:', typeof functionalModule);
                console.log('- z:', typeof z);
                console.log('- functional exports:', Object.keys(functionalModule));
                
                // Initialize functional builders
                initializeFunctionalBuilders();
                
                // Hide loading indicator
                document.getElementById('runBtn').textContent = '▶️ Run Functional Test';
                document.getElementById('runBtn').disabled = false;
                document.getElementById('libraryStatus').innerHTML = '<span class="stat-label">Library</span><span class="stat-value">✅ Ready</span>';
                document.getElementById('libraryStatusDot').classList.add('ready');
                
                console.log('✅ Functional programming dashboard ready!');
                
            } catch (error) {
                console.error('Failed to load UltraFastBuilder:', error);
                document.getElementById('runBtn').textContent = '❌ Library Load Failed';
                document.getElementById('runBtn').disabled = true;
                document.getElementById('libraryStatus').innerHTML = '<span class="stat-label">Library</span><span class="stat-value">❌ Failed</span>';
                document.getElementById('libraryStatusDot').classList.add('error');
                
                const errorMsg = `
                    Failed to load UltraFastBuilder functional library.
                    
                    To fix this:
                    1. Make sure you're running the dashboard via HTTP server (not file://)
                    2. Run: cd packages/clinic-tests && npm run serve
                    3. Open: http://localhost:3000/functional_visual_dashboard.html
                    4. Ensure the builder package is built: npm run build
                    
                    Error: ${error.message}
                `;
                alert(errorMsg);
            }
        }

        // Initialize functional builders
        function initializeFunctionalBuilders() {
            if (!window.functional) {
                console.error('Functional library not available');
                return;
            }

            console.log('Initializing functional builders...');
            console.log('Available functional methods:', Object.keys(window.functional));

            const { createImmutableBuilder, pipe, compose, curry2, partialApply } = window.functional;

            console.log('createImmutableBuilder:', typeof createImmutableBuilder);
            console.log('pipe:', typeof pipe);
            console.log('compose:', typeof compose);
            console.log('curry2:', typeof curry2);
            console.log('partialApply:', typeof partialApply);

            // Create immutable builder for functional tests
            try {
                window.userBuilder = createImmutableBuilder(['id', 'name', 'email', 'age', 'isActive', 'createdAt', 'tags', 'metadata']);
                console.log('User builder created:', window.userBuilder);
                console.log('User builder methods:', Object.keys(window.userBuilder));
            } catch (error) {
                console.error('Failed to create user builder:', error);
                return;
            }
            
            // Create test data
            window.testUsers = [];
            for (let i = 0; i < 1000; i++) {
                window.testUsers.push({
                    id: i,
                    name: `User ${i}`,
                    email: `user${i}@example.com`,
                    age: 25 + (i % 50),
                    isActive: i % 2 === 0,
                    createdAt: new Date(),
                    tags: ['test', 'functional'],
                    metadata: { source: 'test', iteration: i }
                });
            }

            console.log('Functional builders initialized');
        }

        // Run functional programming tests
        window.runFunctionalTest = async function() {
            const iterations = parseInt(document.getElementById('iterations').value);
            const runBtn = document.getElementById('runBtn');
            const testType = document.getElementById('testType').value;
            const complexity = document.getElementById('complexity').value;
            const progressContainer = document.getElementById('progressContainer');

            runBtn.textContent = '⏳ Running...';
            runBtn.classList.add('running');
            runBtn.disabled = true;
            progressContainer.style.display = 'block';
            benchmarkStartTime = performance.now();

            startMetricsCollection();

            try {
                const updateInterval = Math.max(1, Math.floor(iterations / 100));

                // Pipe Operations Test
                if (testType === 'all' || testType === 'pipe') {
                    const pipeStart = performance.now();
                    for (let i = 0; i < iterations; i++) {
                        let user;
                        if (complexity === 'simple') {
                            // Simple: Just 3-4 pipe operations
                            user = window.functional.pipe(
                                window.userBuilder.withId(i),
                                window.userBuilder.withName(`User ${i}`),
                                window.userBuilder.withEmail(`user${i}@example.com`)
                            )(window.userBuilder.empty());
                        } else if (complexity === 'medium') {
                            // Medium: 6-8 pipe operations
                            user = window.functional.pipe(
                                window.userBuilder.withId(i),
                                window.userBuilder.withName(`User ${i}`),
                                window.userBuilder.withEmail(`user${i}@example.com`),
                                window.userBuilder.withAge(25 + (i % 50)),
                                window.userBuilder.withIsActive(i % 2 === 0),
                                window.userBuilder.withCreatedAt(new Date()),
                                window.userBuilder.withTags(['pipe', 'test']),
                                window.userBuilder.withMetadata({ source: 'pipe', iteration: i })
                            )(window.userBuilder.empty());
                        } else { // complex
                            // Complex: 10+ pipe operations with nested transforms
                            const transform1 = window.functional.pipe(
                                window.userBuilder.withId(i),
                                window.userBuilder.withName(`User ${i}`),
                                window.userBuilder.withEmail(`user${i}@example.com`)
                            );
                            const transform2 = window.functional.pipe(
                                window.userBuilder.withAge(25 + (i % 50)),
                                window.userBuilder.withIsActive(i % 2 === 0)
                            );
                            user = window.functional.pipe(
                                transform1,
                                transform2,
                                window.userBuilder.withCreatedAt(new Date()),
                                window.userBuilder.withTags(['pipe', 'complex', 'nested']),
                                window.userBuilder.withMetadata({ source: 'pipe', iteration: i, complexity: 'high' })
                            )(window.userBuilder.empty());
                        }

                        const finalUser = window.userBuilder.build(user);

                        if (i % updateInterval === 0) {
                            updateProgress(i, iterations, `Pipe Operations (${complexity})`);
                            await new Promise(resolve => setTimeout(resolve, 0));
                        }
                    }
                    const pipeTime = performance.now() - pipeStart;
                    const pipeOps = Math.floor(iterations / pipeTime * 1000);
                    benchmarkResults.pipe.push(pipeOps);
                    updateProgress(iterations, iterations, 'Pipe Operations');
                }

                // Compose Functions Test
                if (testType === 'all' || testType === 'compose') {
                    const composeStart = performance.now();

                    for (let i = 0; i < iterations; i++) {
                        let user;
                        if (complexity === 'simple') {
                            // Simple: Single level composition
                            const createUser = window.functional.compose(
                                window.userBuilder.withId(i),
                                window.userBuilder.withName(`User ${i}`),
                                window.userBuilder.withEmail(`user${i}@example.com`)
                            );
                            user = createUser(window.userBuilder.empty());
                        } else if (complexity === 'medium') {
                            // Medium: Two-level composition
                            const createBasicUser = window.functional.compose(
                                window.userBuilder.withId(i),
                                window.userBuilder.withName(`User ${i}`),
                                window.userBuilder.withEmail(`user${i}@example.com`)
                            );
                            const createActiveUser = window.functional.compose(
                                window.userBuilder.withIsActive(i % 2 === 0),
                                window.userBuilder.withAge(25 + (i % 50)),
                                window.userBuilder.withCreatedAt(new Date())
                            );
                            user = window.functional.pipe(
                                createBasicUser,
                                createActiveUser,
                                window.userBuilder.withTags(['compose', 'medium'])
                            )(window.userBuilder.empty());
                        } else { // complex
                            // Complex: Deep composition with multiple levels
                            const level1 = window.functional.compose(
                                window.userBuilder.withId(i),
                                window.userBuilder.withName(`User ${i}`)
                            );
                            const level2 = window.functional.compose(
                                level1,
                                window.userBuilder.withEmail(`user${i}@example.com`)
                            );
                            const level3 = window.functional.compose(
                                level2,
                                window.userBuilder.withAge(25 + (i % 50)),
                                window.userBuilder.withIsActive(i % 2 === 0)
                            );
                            user = window.functional.pipe(
                                level3,
                                window.userBuilder.withCreatedAt(new Date()),
                                window.userBuilder.withTags(['compose', 'complex', 'deep']),
                                window.userBuilder.withMetadata({ depth: 3, iteration: i })
                            )(window.userBuilder.empty());
                        }

                        const finalUser = window.userBuilder.build(user);

                        if (i % updateInterval === 0) {
                            updateProgress(i, iterations, `Compose Functions (${complexity})`);
                            await new Promise(resolve => setTimeout(resolve, 0));
                        }
                    }
                    const composeTime = performance.now() - composeStart;
                    const composeOps = Math.floor(iterations / composeTime * 1000);
                    benchmarkResults.compose.push(composeOps);
                    updateProgress(iterations, iterations, 'Compose Functions');
                }

                // Currying Test
                if (testType === 'all' || testType === 'curry') {
                    const curryStart = performance.now();
                    
                    // Create curried functions
                    const curriedWithId = window.functional.curry2((id, state) => window.userBuilder.withId(id)(state));
                    const curriedWithName = window.functional.curry2((name, state) => window.userBuilder.withName(name)(state));
                    
                    for (let i = 0; i < iterations; i++) {
                        const user = window.functional.pipe(
                            curriedWithId(i),
                            curriedWithName(`User ${i}`),
                            window.userBuilder.withEmail(`user${i}@example.com`),
                            window.userBuilder.withAge(25 + (i % 50)),
                            window.userBuilder.withIsActive(i % 2 === 0),
                            window.userBuilder.withCreatedAt(new Date()),
                            window.userBuilder.withTags(['curry', 'test']),
                            window.userBuilder.withMetadata({ curried: true })
                        )(window.userBuilder.empty());
                        
                        const finalUser = window.userBuilder.build(user);

                        if (i % updateInterval === 0) {
                            updateProgress(i, iterations, 'Currying');
                            await new Promise(resolve => setTimeout(resolve, 0));
                        }
                    }
                    const curryTime = performance.now() - curryStart;
                    const curryOps = Math.floor(iterations / curryTime * 1000);
                    benchmarkResults.curry.push(curryOps);
                    updateProgress(iterations, iterations, 'Currying');
                }

                // Immutable Builders Test
                if (testType === 'all' || testType === 'immutable') {
                    const immutableStart = performance.now();
                    
                    for (let i = 0; i < iterations; i++) {
                        const user = window.userBuilder.build(window.functional.pipe(
                            window.userBuilder.withId(i),
                            window.userBuilder.withName(`User ${i}`),
                            window.userBuilder.withEmail(`user${i}@example.com`),
                            window.userBuilder.withAge(25 + (i % 50)),
                            window.userBuilder.withIsActive(i % 2 === 0),
                            window.userBuilder.withCreatedAt(new Date()),
                            window.userBuilder.withTags(['immutable', 'test']),
                            window.userBuilder.withMetadata({ immutable: true })
                        )(window.userBuilder.empty()));

                        if (i % updateInterval === 0) {
                            updateProgress(i, iterations, 'Immutable Builders');
                            await new Promise(resolve => setTimeout(resolve, 0));
                        }
                    }
                    const immutableTime = performance.now() - immutableStart;
                    const immutableOps = Math.floor(iterations / immutableTime * 1000);
                    benchmarkResults.immutable.push(immutableOps);
                    updateProgress(iterations, iterations, 'Immutable Builders');
                }

                // Higher-Order Functions Test
                if (testType === 'all' || testType === 'higher-order') {
                    const higherOrderStart = performance.now();
                    
                    for (let i = 0; i < iterations; i++) {
                        // Test higher-order functions on test data
                        const activeUsers = window.testUsers.filter(user => user.isActive);
                        const userNames = window.testUsers.map(user => user.name);
                        const totalAge = window.testUsers.reduce((sum, user) => sum + user.age, 0);
                        const hasActiveUsers = window.testUsers.some(user => user.isActive);
                        
                        // Test builder transformations
                        const transformedUsers = window.testUsers.map(user => {
                            const state = window.userBuilder.empty();
                            return window.userBuilder.build(window.functional.pipe(
                                window.userBuilder.withId(user.id),
                                window.userBuilder.withName(user.name.toUpperCase()),
                                window.userBuilder.withEmail(user.email),
                                window.userBuilder.withAge(user.age + 1),
                                window.userBuilder.withIsActive(!user.isActive),
                                window.userBuilder.withCreatedAt(user.createdAt),
                                window.userBuilder.withTags([...user.tags, 'transformed']),
                                window.userBuilder.withMetadata({ ...user.metadata, transformed: true })
                            )(state));
                        });

                        if (i % updateInterval === 0) {
                            updateProgress(i, iterations, 'Higher-Order Functions');
                            await new Promise(resolve => setTimeout(resolve, 0));
                        }
                    }
                    const higherOrderTime = performance.now() - higherOrderStart;
                    const higherOrderOps = Math.floor(iterations / higherOrderTime * 1000);
                    benchmarkResults['higher-order'].push(higherOrderOps);
                    updateProgress(iterations, iterations, 'Higher-Order Functions');
                }

                totalOperations += iterations * (testType === 'all' ? 5 : 1);

                // Update stats
                document.getElementById('totalOps').textContent = totalOperations.toLocaleString();

                // Find fastest
                const allResults = [
                    ...benchmarkResults.pipe,
                    ...benchmarkResults.compose,
                    ...benchmarkResults.curry,
                    ...benchmarkResults.immutable,
                    ...benchmarkResults['higher-order']
                ];
                if (allResults.length > 0) {
                    const maxOps = Math.max(...allResults);
                    if (benchmarkResults.pipe.includes(maxOps)) {
                        document.getElementById('fastest').textContent = 'Pipe Operations';
                    } else if (benchmarkResults.compose.includes(maxOps)) {
                        document.getElementById('fastest').textContent = 'Compose Functions';
                    } else if (benchmarkResults.curry.includes(maxOps)) {
                        document.getElementById('fastest').textContent = 'Currying';
                    } else if (benchmarkResults.immutable.includes(maxOps)) {
                        document.getElementById('fastest').textContent = 'Immutable Builders';
                    } else {
                        document.getElementById('fastest').textContent = 'Higher-Order Functions';
                    }
                }

                updateComparisonTable();
                updateInfoCards();
                drawChart();

            } catch (error) {
                console.error('Functional test error:', error);
                alert('Functional test failed: ' + error.message);
            } finally {
                stopMetricsCollection();
                runBtn.textContent = '▶️ Run Functional Test';
                runBtn.classList.remove('running');
                runBtn.disabled = false;
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 2000);
            }
        }

        function updateComparisonTable() {
            // Get latest results
            const pipeOps = benchmarkResults.pipe[benchmarkResults.pipe.length - 1] || 0;
            const composeOps = benchmarkResults.compose[benchmarkResults.compose.length - 1] || 0;
            const curryOps = benchmarkResults.curry[benchmarkResults.curry.length - 1] || 0;
            const immutableOps = benchmarkResults.immutable[benchmarkResults.immutable.length - 1] || 0;
            const higherOrderOps = benchmarkResults['higher-order'][benchmarkResults['higher-order'].length - 1] || 0;

            console.log('Updating comparison table with results:', {
                pipeOps, composeOps, curryOps, immutableOps, higherOrderOps
            });

            if (pipeOps === 0 && composeOps === 0 && curryOps === 0 && immutableOps === 0 && higherOrderOps === 0) {
                console.log('No data to display yet');
                return; // No data yet
            }

            // Calculate metrics
            const allOps = [pipeOps, composeOps, curryOps, immutableOps, higherOrderOps];
            const maxOps = Math.max(...allOps);

            // Throughput (ops/sec)
            function formatOps(ops) {
                return ops > 0 ? (ops / 1000).toFixed(1) + 'k ops/s' : '-';
            }

            // Update throughput values
            const pipeOpsElement = document.getElementById('pipe-ops');
            const composeOpsElement = document.getElementById('compose-ops');
            const curryOpsElement = document.getElementById('curry-ops');
            const immutableOpsElement = document.getElementById('immutable-ops');
            const higherOrderOpsElement = document.getElementById('higher-order-ops');
            
            console.log('Updating elements:', {
                pipeOpsElement: !!pipeOpsElement,
                composeOpsElement: !!composeOpsElement,
                curryOpsElement: !!curryOpsElement,
                immutableOpsElement: !!immutableOpsElement,
                higherOrderOpsElement: !!higherOrderOpsElement
            });
            
            if (pipeOpsElement) pipeOpsElement.textContent = formatOps(pipeOps);
            if (composeOpsElement) composeOpsElement.textContent = formatOps(composeOps);
            if (curryOpsElement) curryOpsElement.textContent = formatOps(curryOps);
            if (immutableOpsElement) immutableOpsElement.textContent = formatOps(immutableOps);
            if (higherOrderOpsElement) higherOrderOpsElement.textContent = formatOps(higherOrderOps);

            // Highlight best
            document.getElementById('pipe-ops').classList.toggle('best-value', pipeOps === maxOps && pipeOps > 0);
            document.getElementById('compose-ops').classList.toggle('best-value', composeOps === maxOps && composeOps > 0);
            document.getElementById('curry-ops').classList.toggle('best-value', curryOps === maxOps && curryOps > 0);
            document.getElementById('immutable-ops').classList.toggle('best-value', immutableOps === maxOps && immutableOps > 0);
            document.getElementById('higher-order-ops').classList.toggle('best-value', higherOrderOps === maxOps && higherOrderOps > 0);

            // Speed (microseconds per operation)
            function formatSpeed(ops) {
                return ops > 0 ? (1000000 / ops).toFixed(2) + ' μs' : '-';
            }

            const pipeSpeed = pipeOps > 0 ? 1000000 / pipeOps : 0;
            const composeSpeed = composeOps > 0 ? 1000000 / composeOps : 0;
            const currySpeed = curryOps > 0 ? 1000000 / curryOps : 0;
            const immutableSpeed = immutableOps > 0 ? 1000000 / immutableOps : 0;
            const higherOrderSpeed = higherOrderOps > 0 ? 1000000 / higherOrderOps : 0;
            const speeds = [pipeSpeed, composeSpeed, currySpeed, immutableSpeed, higherOrderSpeed].filter(s => s > 0);
            const minSpeed = speeds.length > 0 ? Math.min(...speeds) : 0;

            // Update speed values
            const pipeSpeedElement = document.getElementById('pipe-speed');
            const composeSpeedElement = document.getElementById('compose-speed');
            const currySpeedElement = document.getElementById('curry-speed');
            const immutableSpeedElement = document.getElementById('immutable-speed');
            const higherOrderSpeedElement = document.getElementById('higher-order-speed');
            
            if (pipeSpeedElement) pipeSpeedElement.textContent = formatSpeed(pipeOps);
            if (composeSpeedElement) composeSpeedElement.textContent = formatSpeed(composeOps);
            if (currySpeedElement) currySpeedElement.textContent = formatSpeed(curryOps);
            if (immutableSpeedElement) immutableSpeedElement.textContent = formatSpeed(immutableOps);
            if (higherOrderSpeedElement) higherOrderSpeedElement.textContent = formatSpeed(higherOrderOps);

            document.getElementById('pipe-speed').classList.toggle('best-value', pipeSpeed === minSpeed && pipeSpeed > 0);
            document.getElementById('compose-speed').classList.toggle('best-value', composeSpeed === minSpeed && composeSpeed > 0);
            document.getElementById('curry-speed').classList.toggle('best-value', currySpeed === minSpeed && currySpeed > 0);
            document.getElementById('immutable-speed').classList.toggle('best-value', immutableSpeed === minSpeed && immutableSpeed > 0);
            document.getElementById('higher-order-speed').classList.toggle('best-value', higherOrderSpeed === minSpeed && higherOrderSpeed > 0);

            // Memory usage (simplified)
            const memoryUsage = currentMemory / 1024 / 1024; // MB
            const memoryText = memoryUsage.toFixed(2) + ' MB';
            
            const pipeMemoryElement = document.getElementById('pipe-memory');
            const composeMemoryElement = document.getElementById('compose-memory');
            const curryMemoryElement = document.getElementById('curry-memory');
            const immutableMemoryElement = document.getElementById('immutable-memory');
            const higherOrderMemoryElement = document.getElementById('higher-order-memory');
            
            if (pipeMemoryElement) pipeMemoryElement.textContent = memoryText;
            if (composeMemoryElement) composeMemoryElement.textContent = memoryText;
            if (curryMemoryElement) curryMemoryElement.textContent = memoryText;
            if (immutableMemoryElement) immutableMemoryElement.textContent = memoryText;
            if (higherOrderMemoryElement) higherOrderMemoryElement.textContent = memoryText;

            // Calculate average throughput
            const avgThroughput = allOps.filter(ops => ops > 0).reduce((sum, ops) => sum + ops, 0) / allOps.filter(ops => ops > 0).length;
            document.getElementById('avgThroughput').textContent = avgThroughput > 0 ? (avgThroughput / 1000).toFixed(1) + 'k ops/s' : '-';
            document.getElementById('memoryEfficiency').textContent = memoryUsage > 0 ? (totalOperations / memoryUsage).toFixed(0) + ' ops/MB' : '-';
        }

        function updateInfoCards() {
            console.log('Updating info cards...');
            
            // Update total operations
            const totalOpsElement = document.getElementById('totalOps');
            if (totalOpsElement) {
                totalOpsElement.textContent = totalOperations.toLocaleString();
            }
            
            // Update fastest test
            const fastestElement = document.getElementById('fastest');
            if (fastestElement) {
                const allResults = [
                    ...benchmarkResults.pipe,
                    ...benchmarkResults.compose,
                    ...benchmarkResults.curry,
                    ...benchmarkResults.immutable,
                    ...benchmarkResults['higher-order']
                ];
                
                if (allResults.length > 0) {
                    const maxOps = Math.max(...allResults);
                    if (benchmarkResults.pipe.includes(maxOps)) {
                        fastestElement.textContent = 'Pipe Operations';
                    } else if (benchmarkResults.compose.includes(maxOps)) {
                        fastestElement.textContent = 'Compose Functions';
                    } else if (benchmarkResults.curry.includes(maxOps)) {
                        fastestElement.textContent = 'Currying';
                    } else if (benchmarkResults.immutable.includes(maxOps)) {
                        fastestElement.textContent = 'Immutable Builders';
                    } else {
                        fastestElement.textContent = 'Higher-Order Functions';
                    }
                }
            }
            
            // Update average throughput
            const avgThroughputElement = document.getElementById('avgThroughput');
            if (avgThroughputElement) {
                const allOps = [
                    ...benchmarkResults.pipe,
                    ...benchmarkResults.compose,
                    ...benchmarkResults.curry,
                    ...benchmarkResults.immutable,
                    ...benchmarkResults['higher-order']
                ].filter(ops => ops > 0);
                
                if (allOps.length > 0) {
                    const avgThroughput = allOps.reduce((sum, ops) => sum + ops, 0) / allOps.length;
                    avgThroughputElement.textContent = (avgThroughput / 1000).toFixed(1) + 'k ops/s';
                } else {
                    avgThroughputElement.textContent = '-';
                }
            }
            
            // Update memory efficiency
            const memoryEfficiencyElement = document.getElementById('memoryEfficiency');
            if (memoryEfficiencyElement) {
                const memoryUsage = currentMemory / 1024 / 1024; // MB
                if (memoryUsage > 0) {
                    memoryEfficiencyElement.textContent = (totalOperations / memoryUsage).toFixed(0) + ' ops/MB';
                } else {
                    memoryEfficiencyElement.textContent = '-';
                }
            }
            
            console.log('Info cards updated');
        }

        function updateProgress(current, total, testName) {
            const percentage = (current / total) * 100;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${testName}: ${current}/${total} (${percentage.toFixed(1)}%)`;
        }

        function startMetricsCollection() {
            currentMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            metricsInterval = setInterval(() => {
                if (performance.memory) {
                    currentMemory = performance.memory.usedJSHeapSize;
                }
            }, 100);
        }

        function stopMetricsCollection() {
            if (metricsInterval) {
                clearInterval(metricsInterval);
                metricsInterval = null;
            }
        }

        function clearResults() {
            benchmarkResults = {
                pipe: [],
                compose: [],
                curry: [],
                immutable: [],
                'higher-order': []
            };
            totalOperations = 0;
            currentMemory = 0;
            
            // Clear table
            ['pipe', 'compose', 'curry', 'immutable', 'higher-order'].forEach(type => {
                document.getElementById(`${type}-ops`).textContent = '-';
                document.getElementById(`${type}-speed`).textContent = '-';
                document.getElementById(`${type}-memory`).textContent = '-';
                document.getElementById(`winner-${type}`).textContent = '-';
                document.getElementById(`${type}-ops`).classList.remove('best-value');
                document.getElementById(`${type}-speed`).classList.remove('best-value');
            });
            
            document.getElementById('totalOps').textContent = '0';
            document.getElementById('fastest').textContent = '-';
            document.getElementById('avgThroughput').textContent = '-';
            document.getElementById('memoryEfficiency').textContent = '-';
            
            drawInitialChart();
        }

        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                results: benchmarkResults,
                totalOperations: totalOperations,
                memoryUsage: currentMemory
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `functional-test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }


        // Initialize when page loads
        window.addEventListener('load', () => {
            initCanvas();
            loadLibrary();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            initCanvas();
            drawChart();
        });
    </script>

    <script>
        // Code section toggle functionality
        function toggleCodeSection() {
            const content = document.getElementById('codeContent');
            const toggle = document.getElementById('codeToggle');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
                toggle.textContent = '▶';
            } else {
                content.classList.add('expanded');
                toggle.classList.add('expanded');
                toggle.textContent = '▼';
            }
        }

        // Code tab switching functionality
        function showCodeTab(tabName) {
            // Hide all code blocks
            const codeBlocks = document.querySelectorAll('.code-block');
            codeBlocks.forEach(block => block.style.display = 'none');

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.code-tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected code block
            const selectedBlock = document.getElementById(tabName + '-code');
            if (selectedBlock) {
                selectedBlock.style.display = 'block';
            }

            // Add active class to selected tab
            const selectedTab = event.target;
            selectedTab.classList.add('active');
        }

        // Update code examples based on complexity
        function updateCodeExamples() {
            const complexity = document.getElementById('complexity').value;

            const examples = {
                simple: {
                    pipe: `<span class="comment">// Pipe Operations - Simple (3-4 operations)</span>
<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());

<span class="keyword">const</span> <span class="variable">finalUser</span> = <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">user</span>);`,

                    compose: `<span class="comment">// Compose Functions - Simple (single level)</span>
<span class="keyword">const</span> <span class="variable">createUser</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">createUser</span>(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());
<span class="keyword">const</span> <span class="variable">finalUser</span> = <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">user</span>);`,

                    curry: `<span class="comment">// Currying - Simple (curry2 only)</span>
<span class="keyword">const</span> <span class="variable">curriedWithId</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">curry2</span>((<span class="variable">id</span>, <span class="variable">state</span>) =>
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">id</span>)(<span class="variable">state</span>)
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">curriedWithId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());`,

                    immutable: `<span class="comment">// Immutable Builders - Simple</span>
<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
)(<span class="variable">userBuilder</span>.<span class="function">empty</span>()));`,

                    'higher-order': `<span class="comment">// Higher-Order Functions - Simple</span>
<span class="keyword">const</span> <span class="variable">activeUsers</span> = <span class="variable">users</span>.<span class="function">filter</span>(<span class="variable">u</span> => <span class="variable">u</span>.<span class="variable">isActive</span>);
<span class="keyword">const</span> <span class="variable">names</span> = <span class="variable">users</span>.<span class="function">map</span>(<span class="variable">u</span> => <span class="variable">u</span>.<span class="variable">name</span>);
<span class="keyword">const</span> <span class="variable">totalAge</span> = <span class="variable">users</span>.<span class="function">reduce</span>((<span class="variable">sum</span>, <span class="variable">u</span>) => <span class="variable">sum</span> + <span class="variable">u</span>.<span class="variable">age</span>, <span class="variable">0</span>);`
                },

                medium: {
                    pipe: `<span class="comment">// Pipe Operations - Medium (6-8 operations)</span>
<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'pipe'</span>, <span class="string">'test'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">source</span>: <span class="string">'pipe'</span>, <span class="variable">iteration</span>: <span class="variable">i</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());

<span class="keyword">const</span> <span class="variable">finalUser</span> = <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">user</span>);`,

                    compose: `<span class="comment">// Compose Functions - Medium (two-level composition)</span>
<span class="keyword">const</span> <span class="variable">createBasicUser</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
);

<span class="keyword">const</span> <span class="variable">createActiveUser</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>())
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">createBasicUser</span>,
    <span class="variable">createActiveUser</span>,
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'compose'</span>, <span class="string">'medium'</span>])
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());`,

                    curry: `<span class="comment">// Currying - Medium (curry2 and curry3)</span>
<span class="keyword">const</span> <span class="variable">curriedWithId</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">curry2</span>((<span class="variable">id</span>, <span class="variable">state</span>) =>
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">id</span>)(<span class="variable">state</span>)
);

<span class="keyword">const</span> <span class="variable">curriedWithName</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">curry2</span>((<span class="variable">name</span>, <span class="variable">state</span>) =>
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="variable">name</span>)(<span class="variable">state</span>)
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">curriedWithId</span>(<span class="variable">i</span>),
    <span class="variable">curriedWithName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'curry'</span>, <span class="string">'test'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">curried</span>: <span class="keyword">true</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());`,

                    immutable: `<span class="comment">// Immutable Builders - Medium (full pipeline)</span>
<span class="keyword">const</span> <span class="variable">userBuilder</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">createImmutableBuilder</span>([
    <span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'email'</span>, <span class="string">'age'</span>,
    <span class="string">'isActive'</span>, <span class="string">'createdAt'</span>, <span class="string">'tags'</span>, <span class="string">'metadata'</span>
]);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>),
    <span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>),
    <span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'immutable'</span>, <span class="string">'test'</span>]),
    <span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">immutable</span>: <span class="keyword">true</span> })
)(<span class="variable">userBuilder</span>.<span class="function">empty</span>()));`,

                    'higher-order': `<span class="comment">// Higher-Order Functions - Medium (chained transformations)</span>
<span class="keyword">const</span> <span class="variable">activeUsers</span> = <span class="variable">users</span>.<span class="function">filter</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">isActive</span>);
<span class="keyword">const</span> <span class="variable">userNames</span> = <span class="variable">users</span>.<span class="function">map</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">name</span>);
<span class="keyword">const</span> <span class="variable">totalAge</span> = <span class="variable">users</span>.<span class="function">reduce</span>((<span class="variable">sum</span>, <span class="variable">user</span>) => <span class="variable">sum</span> + <span class="variable">user</span>.<span class="variable">age</span>, <span class="variable">0</span>);
<span class="keyword">const</span> <span class="variable">hasActiveUsers</span> = <span class="variable">users</span>.<span class="function">some</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">isActive</span>);
<span class="keyword">const</span> <span class="variable">allUsersActive</span> = <span class="variable">users</span>.<span class="function">every</span>(<span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">isActive</span>);`
                },

                complex: {
                    pipe: `<span class="comment">// Pipe Operations - Complex (10+ operations with nested transforms)</span>
<span class="keyword">const</span> <span class="variable">transform1</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
);

<span class="keyword">const</span> <span class="variable">transform2</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>)
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">transform1</span>,
    <span class="variable">transform2</span>,
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'pipe'</span>, <span class="string">'complex'</span>, <span class="string">'nested'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">source</span>: <span class="string">'pipe'</span>, <span class="variable">iteration</span>: <span class="variable">i</span>, <span class="variable">complexity</span>: <span class="string">'high'</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());`,

                    compose: `<span class="comment">// Compose Functions - Complex (three-level deep composition)</span>
<span class="keyword">const</span> <span class="variable">level1</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>)
);

<span class="keyword">const</span> <span class="variable">level2</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">level1</span>,
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>)
);

<span class="keyword">const</span> <span class="variable">level3</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">level2</span>,
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withIsActive</span>(<span class="variable">i</span> % <span class="variable">2</span> === <span class="variable">0</span>)
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">level3</span>,
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>()),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'compose'</span>, <span class="string">'complex'</span>, <span class="string">'deep'</span>]),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withMetadata</span>({ <span class="variable">depth</span>: <span class="variable">3</span>, <span class="variable">iteration</span>: <span class="variable">i</span> })
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());`,

                    curry: `<span class="comment">// Currying - Complex (curry2, curry3, curry4 with partial application)</span>
<span class="keyword">const</span> <span class="variable">curry3</span> = <span class="variable">fn</span> => <span class="variable">a</span> => <span class="variable">b</span> => <span class="variable">c</span> => <span class="variable">fn</span>(<span class="variable">a</span>, <span class="variable">b</span>, <span class="variable">c</span>);

<span class="keyword">const</span> <span class="variable">curriedWith3</span> = <span class="variable">curry3</span>((<span class="variable">id</span>, <span class="variable">name</span>, <span class="variable">state</span>) => {
    <span class="keyword">return</span> <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
        <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">id</span>),
        <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="variable">name</span>)
    )(<span class="variable">state</span>);
});

<span class="keyword">const</span> <span class="variable">partialUser</span> = <span class="variable">curriedWith3</span>(<span class="variable">i</span>)(<span class="string">\`User \${i}\`</span>);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">state</span> => <span class="variable">partialUser</span>(<span class="variable">state</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withAge</span>(<span class="variable">25</span> + (<span class="variable">i</span> % <span class="variable">50</span>)),
    <span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'curry'</span>, <span class="string">'complex'</span>])
)(<span class="variable">window</span>.<span class="variable">userBuilder</span>.<span class="function">empty</span>());`,

                    immutable: `<span class="comment">// Immutable Builders - Complex (with transformations)</span>
<span class="keyword">const</span> <span class="variable">transform</span> = <span class="variable">state</span> => ({
    ...<span class="variable">state</span>,
    <span class="variable">metadata</span>: { ...<span class="variable">state</span>.<span class="variable">metadata</span>, <span class="variable">transformed</span>: <span class="keyword">true</span> }
});

<span class="keyword">const</span> <span class="variable">enrichState</span> = <span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">compose</span>(
    <span class="variable">userBuilder</span>.<span class="function">withTags</span>([<span class="string">'immutable'</span>, <span class="string">'complex'</span>]),
    <span class="variable">state</span> => <span class="variable">transform</span>(<span class="variable">state</span>),
    <span class="variable">userBuilder</span>.<span class="function">withCreatedAt</span>(<span class="keyword">new</span> <span class="function">Date</span>())
);

<span class="keyword">const</span> <span class="variable">user</span> = <span class="variable">userBuilder</span>.<span class="function">build</span>(<span class="variable">window</span>.<span class="variable">functional</span>.<span class="function">pipe</span>(
    <span class="variable">userBuilder</span>.<span class="function">withId</span>(<span class="variable">i</span>),
    <span class="variable">userBuilder</span>.<span class="function">withName</span>(<span class="string">\`User \${i}\`</span>),
    <span class="variable">userBuilder</span>.<span class="function">withEmail</span>(<span class="string">\`user\${i}@example.com\`</span>),
    <span class="variable">enrichState</span>
)(<span class="variable">userBuilder</span>.<span class="function">empty</span>()));`,

                    'higher-order': `<span class="comment">// Higher-Order Functions - Complex (nested transformations)</span>
<span class="keyword">const</span> <span class="variable">transformUser</span> = <span class="variable">user</span> => ({ ...<span class="variable">user</span>, <span class="variable">processed</span>: <span class="keyword">true</span> });
<span class="keyword">const</span> <span class="variable">isAdult</span> = <span class="variable">user</span> => <span class="variable">user</span>.<span class="variable">age</span> >= <span class="variable">18</span>;

<span class="keyword">const</span> <span class="variable">processedUsers</span> = <span class="variable">users</span>
    .<span class="function">filter</span>(<span class="variable">isAdult</span>)
    .<span class="function">map</span>(<span class="variable">transformUser</span>)
    .<span class="function">filter</span>(<span class="variable">u</span> => <span class="variable">u</span>.<span class="variable">isActive</span>)
    .<span class="function">map</span>(<span class="variable">u</span> => ({ ...<span class="variable">u</span>, <span class="variable">normalized</span>: <span class="keyword">true</span> }));

<span class="keyword">const</span> <span class="variable">avgAge</span> = <span class="variable">processedUsers</span>.<span class="function">reduce</span>(
    (<span class="variable">sum</span>, <span class="variable">u</span>) => <span class="variable">sum</span> + <span class="variable">u</span>.<span class="variable">age</span>, <span class="variable">0</span>
) / <span class="variable">processedUsers</span>.<span class="variable">length</span>;`
                }
            };

            // Update each code block
            document.getElementById('pipe-code').innerHTML = examples[complexity].pipe;
            document.getElementById('compose-code').innerHTML = examples[complexity].compose;
            document.getElementById('curry-code').innerHTML = examples[complexity].curry;
            document.getElementById('immutable-code').innerHTML = examples[complexity].immutable;
            document.getElementById('higher-order-code').innerHTML = examples[complexity]['higher-order'];
        }
    </script>
</body>
</html>
